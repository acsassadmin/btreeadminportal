{% extends "base.html" %}
{% block title %}Create Student{% endblock %}

{% block content %}
<h2>Create New Student</h2>

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}

    <h4>Student Details</h4>
    <div class="card p-3 mb-4">
        {{ student_form.as_p }}
    </div>
    <hr>
    <h4>Payment Details</h4>
    <div class="card p-3 mb-4">
        {{ payment_form.as_p }}
    </div>

    <button type="submit" class="btn btn-success">Save Student</button>
    <a href="{% url 'student_list' %}" class="btn btn-secondary">Back to Student List</a>
</form>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const emiType = document.getElementById("id_emi_type");

    const emi1Fields = [
        document.getElementById("id_emi_1_amount"),
        document.getElementById("id_emi_1_date")
    ];
    const emi2Fields = [
        document.getElementById("id_emi_2_amount"),
        document.getElementById("id_emi_2_date")
    ];
    const emi3Fields = [
        document.getElementById("id_emi_3_amount"),
        document.getElementById("id_emi_3_date")
    ];
    const emi4Fields = [
        document.getElementById("id_emi_4_amount"),
        document.getElementById("id_emi_4_date")
    ];

    function hideAllEMI() {
        [...emi1Fields, ...emi2Fields, ...emi3Fields, ...emi4Fields].forEach(el => {
            el.closest('p').style.display = 'none';
        });
    }

    function showEMIFields() {
        hideAllEMI();
        const type = emiType.value;

        if (type === '2') {
            [...emi1Fields, ...emi2Fields].forEach(el => el.closest('p').style.display = 'block');
        } else if (type === '3') {
            [...emi1Fields, ...emi2Fields, ...emi3Fields].forEach(el => el.closest('p').style.display = 'block');
        } else if (type === '4') {
            [...emi1Fields, ...emi2Fields, ...emi3Fields, ...emi4Fields].forEach(el => el.closest('p').style.display = 'block');
        } else {
            hideAllEMI();  // For 'NONE'
        }
    }

    emiType.addEventListener("change", showEMIFields);
    showEMIFields();  // trigger on load
});
</script>
{% endblock %}
