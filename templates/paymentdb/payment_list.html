{% extends "base.html" %}
{% block title %}All Payments{% endblock %}

{% block content %}
<h2>All Payments</h2>

<form method="get" class="mb-3">
    <label for="search">Search (Student ID / Name / Consultant):</label>
    <input type="text" id="search" name="search" value="{{ request.GET.search|default_if_none:'' }}">

    <label for="emi_type">EMI Type:</label>
    <select name="emi_type" id="emi_type">
        <option value="">--Select EMI Type--</option>
        <option value="NONE" {% if request.GET.emi_type == 'NONE' %}selected{% endif %}>None</option>
        <option value="2" {% if request.GET.emi_type == '2' %}selected{% endif %}>2</option>
        <option value="3" {% if request.GET.emi_type == '3' %}selected{% endif %}>3</option>
        <option value="4" {% if request.GET.emi_type == '4' %}selected{% endif %}>4</option>
    </select>

    <label for="emi_field">Select EMI Date Field:</label>
    <select name="emi_field" id="emi_field">
        <option value="">--Select EMI--</option>
        <option value="emi_1_date" {% if request.GET.emi_field == 'emi_1_date' %}selected{% endif %}>EMI 1 Date</option>
        <option value="emi_2_date" {% if request.GET.emi_field == 'emi_2_date' %}selected{% endif %}>EMI 2 Date</option>
        <option value="emi_3_date" {% if request.GET.emi_field == 'emi_3_date' %}selected{% endif %}>EMI 3 Date</option>
        <option value="emi_4_date" {% if request.GET.emi_field == 'emi_4_date' %}selected{% endif %}>EMI 4 Date</option>
    </select>

    <label for="start_date">Start Date:</label>
    <input type="date" id="start_date" name="start_date" value="{{ request.GET.start_date|default_if_none:'' }}">

    <label for="end_date">End Date:</label>
    <input type="date" id="end_date" name="end_date" value="{{ request.GET.end_date|default_if_none:'' }}">

    <button type="submit" class="btn btn-primary">Filter</button>
    <a href="{% url 'payment_list' %}" class="btn btn-secondary">Reset</a>
</form>


<table border="1" cellpadding="8" cellspacing="0">
    <thead>
        <tr>
            <th>Student ID</th>
            <th>Student Name</th>
            <th>Consultant</th>
            <th>Total Fees</th>
            <th>Amount Paid</th>
            <th>Pending Amount</th>
            <th>EMI Type</th>
            <th>EMI 1 Amount</th>
            <th>EMI 1 Date</th>
            <th>EMI 2 Amount</th>
            <th>EMI 2 Date</th>
            <th>EMI 3 Amount</th>
            <th>EMI 3 Date</th>
            <th>EMI 4 Amount</th>
            <th>EMI 4 Date</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
    {% if payments %}
        {% for payment in payments %}
        <tr>
            <td>{{ payment.student.student_id }}</td>
            <td>{{ payment.student.name }}</td>
            <td>{{ payment.student.consultant.name }}</td>
            <td>{{ payment.total_fees }}</td>
            <td>{{ payment.amount_paid }}</td>
            <td>{{ payment.total_pending_amount }}</td>
            <td>{{ payment.get_emi_type_display }}</td>
            <td>{{ payment.emi_1_amount|default:"-" }}</td>
            <td>{{ payment.emi_1_date|date:"Y-m-d" }}</td>
            <td>{{ payment.emi_2_amount|default:"-" }}</td>
            <td>{{ payment.emi_2_date|date:"Y-m-d" }}</td>
            <td>{{ payment.emi_3_amount|default:"-" }}</td>
            <td>{{ payment.emi_3_date|date:"Y-m-d" }}</td>
            <td>{{ payment.emi_4_amount|default:"-" }}</td>
            <td>{{ payment.emi_4_date|date:"Y-m-d" }}</td>
            <td>
                <a href="{% url 'payment_update' payment.id %}">Update</a>
            </td>
        </tr>
        {% endfor %}
    {% else %}
        <tr>
            <td colspan="16" style="text-align:center;">No payment records found.</td>
        </tr>
    {% endif %}
    </tbody>
</table>

{% endblock %}
